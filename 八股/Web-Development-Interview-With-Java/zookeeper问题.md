# zookeeper问题

## 1、什么是zookeeper?（跟谁学）

是一个开源的分布式协同服务系统，Zookeeper的设计目标是将那些复杂容易出错的分布式一致性服务封装起来。

## 2、Zookeeper可以实现什么功能？

服务的**注册与发现**、分布式锁、集群管理、负载均衡等等。

## 3、Zookeeper的数据模型？（有赞）（滴滴）

共享的、树形结构，由一系列的 ZNode数据节点组成，类似文件系统(目录不能存数据）。ZNode存有数据信息，如版本号等等。ZNode之间的层级关系，像文件系统中的目录结构一样。并且它是将数据存在内存中，这样可以提高吞吐、减少延迟。

## 4、如何识别请求的先后顺序？

ZooKeeper会给每个更新请求，分配一个全局唯一的递增编号（zxid)，编号的大小体现事务操作的先后顺序。

## 5、Znode的类型？

持久节点：一旦创建，除非主动移除，否则会一直保存在ZooKeeper。

临时节点：生命周期和客户端会话绑定，会话失效，相关的临时节点被移除

## 6、ZooKeeper定义了几种权限？

1. CREATE
2. READ
3. WRITE
4. DELETE
5. ADMIN

## 7、ZAB了解吗？（跟谁学）（有赞）

全称 **Zookeeper Atomic Broadcast** （Zookeeper原子广播）。

Zookeeper 是通过 Zab 协议来保证分布式事务的最终一致性。是一种支持崩溃恢复的原子广播协议。

zab有两种基本模式:

1. 崩溃恢复：在正常情况下运行非常良好，一旦Leader出现崩溃或者由于网络原因导致Leader服务器失去了与过半Follower的联系，那么就会进入崩溃恢复模式。为了程序的正确运行，整个恢复过程后需要选举出一个新的Leader,因此需要一个高效可靠的选举方法快速选举出一个Leader。
2. 消息广播：类似一个两阶段提交过程，针对客户端的事务请求， Leader服务器会为其生成对应的事务Proposal,并将其发送给集群中的其余所有机器，再分别收集各自的选票，最后进行事务提交。

## 8、什么情况会导致ZAB进入崩溃恢复模式并选取出新的leader？

启动过程或Leader出现网络中断、崩溃退出与重启等异常情况时。

当选举出新的Leader后，同时集群中已有过半的机器与该Leader服务器完成了状态同步之后，ZAB就会退出恢复模式。

## 9、如何创建一个Znode？

```shell 
create -e或者-s /aaa "bbb"
```

## 10、如何获取指定节点信息？

```shell 
get /aaa
```

## 11、如何查看子节点信息？

```shell
ls /aaa
```

## 12、如何更新指定节点信息？

```shell
set /aaa "ccc"
```

## 13、如何删除指定节点？

```shell
delete /aaa
```

## 14、watch监听器？

ZooKeeper允许用户在指定节点上注册Watcher,当触发特定事件时，ZooKeeper服务端会把相应的事件通知到相应的客户端上，属于ZooKeeper一个重要的特性。

```
get /aaa watch 监控节点变化
```

## 15、客户端如何获取配置信息？

启动时主动到服务端拉取信息，同时，在制定节点注册Watcher监听。一旦有配置变化，服务端就会实时通知订阅它的所有客户端。
